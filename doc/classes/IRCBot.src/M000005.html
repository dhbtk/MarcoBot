<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>handle_server_input (IRCBot)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre><span class="ruby-comment cmt"># File marcobot.rb, line 74</span>
        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handle_server_input</span>(<span class="ruby-identifier">s</span>)
                <span class="ruby-identifier">s</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">chomp</span>
                <span class="ruby-identifier">s_spaces</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-value str">&quot;:&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>).<span class="ruby-identifier">split</span>
                <span class="ruby-identifier">s_colons</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;:&quot;</span>)
                <span class="ruby-identifier">message</span> = <span class="ruby-identifier">s_colons</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;:&quot;</span>).<span class="ruby-identifier">sub</span>(<span class="ruby-identifier">s_colons</span>[<span class="ruby-value">1</span>],<span class="ruby-value str">&quot;&quot;</span>).<span class="ruby-identifier">sub</span>(<span class="ruby-value str">&quot;::&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>)
                <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;PING&quot;</span> <span class="ruby-keyword kw">then</span>
                        <span class="ruby-identifier">send</span> <span class="ruby-value str">&quot;PONG &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-value str">&quot;:&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>)
                <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;PRIVMSG&quot;</span> <span class="ruby-keyword kw">then</span>
                        <span class="ruby-identifier">user</span> = <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-value str">&quot;:&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>).<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;!&quot;</span>)[<span class="ruby-value">0</span>]
                        <span class="ruby-identifier">target</span> = <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">2</span>]
                        <span class="ruby-identifier">message</span> = <span class="ruby-identifier">s_colons</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;:&quot;</span>).<span class="ruby-identifier">sub</span>(<span class="ruby-identifier">s_colons</span>[<span class="ruby-value">1</span>],<span class="ruby-value str">&quot;&quot;</span>).<span class="ruby-identifier">sub</span>(<span class="ruby-value str">&quot;::&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>)
                        <span class="ruby-identifier">handle_message</span>(<span class="ruby-identifier">user</span>,<span class="ruby-identifier">target</span>,<span class="ruby-identifier">message</span>,<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-value str">&quot;:&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>))
                <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;INVITE&quot;</span> <span class="ruby-keyword kw">then</span>
                        <span class="ruby-identifier">handle_invite</span>(<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">3</span>])
                <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;TOPIC&quot;</span> <span class="ruby-keyword kw">then</span>
                        <span class="ruby-identifier">handle_topic</span>(<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">0</span>],<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">2</span>],<span class="ruby-identifier">s_colons</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;:&quot;</span>).<span class="ruby-identifier">sub</span>(<span class="ruby-identifier">s_colons</span>[<span class="ruby-value">1</span>],<span class="ruby-value str">&quot;&quot;</span>).<span class="ruby-identifier">sub</span>(<span class="ruby-value str">&quot;::&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>))
                <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;KICK&quot;</span> <span class="ruby-keyword kw">then</span>
                        <span class="ruby-identifier">handle_kick</span>(<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">0</span>],<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">2</span>],<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">3</span>],<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">4</span>])
                        <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;NAMES #{s_spaces[2].sub(&quot;:&quot;,&quot;&quot;)}&quot;</span>)
                <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span> <span class="ruby-node">&quot;:#{@nick} MODE #{@nick} :+wx&quot;</span> <span class="ruby-keyword kw">then</span>
                        <span class="ruby-identifier">startup_routine</span>()
                <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;MODE&quot;</span> <span class="ruby-keyword kw">then</span>
                        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">4</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">then</span>
                                <span class="ruby-identifier">log</span>(<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">2</span>],<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">0</span>],<span class="ruby-node">&quot;#{s_spaces[3]} #{s_spaces[4]}&quot;</span>,<span class="ruby-value str">&quot;usermode&quot;</span>)
                                <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">4</span>].<span class="ruby-identifier">strip</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@configfile</span>[<span class="ruby-value str">'nick'</span>] <span class="ruby-keyword kw">then</span>
                                        <span class="ruby-ivar">@chanmodes</span>[<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">downcase</span>] = <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">3</span>].<span class="ruby-identifier">strip</span>
                                <span class="ruby-keyword kw">end</span>
                        <span class="ruby-keyword kw">else</span>
                                <span class="ruby-identifier">log</span>(<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">2</span>],<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">0</span>],<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">3</span>],<span class="ruby-value str">&quot;chanmode&quot;</span>)
                        <span class="ruby-keyword kw">end</span>
                <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;PART&quot;</span> <span class="ruby-keyword kw">then</span>
                        <span class="ruby-identifier">log</span>(<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">2</span>],<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">0</span>],<span class="ruby-identifier">message</span>,<span class="ruby-value str">&quot;part&quot;</span>)
                        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;!&quot;</span>)[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-ivar">@nick</span> <span class="ruby-keyword kw">then</span>
                                <span class="ruby-ivar">@channel</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">downcase</span>)
                        <span class="ruby-keyword kw">end</span>
                        <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;NAMES #{s_spaces[2].sub(&quot;:&quot;,&quot;&quot;)}&quot;</span>)
                <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;JOIN&quot;</span> <span class="ruby-keyword kw">then</span>
                        <span class="ruby-identifier">log</span>(<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-value str">&quot;:&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>),<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">0</span>],<span class="ruby-value str">&quot;&quot;</span>,<span class="ruby-value str">&quot;join&quot;</span>)
                        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;!&quot;</span>)[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-ivar">@nick</span> <span class="ruby-keyword kw">then</span>
                                <span class="ruby-ivar">@channel</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-value str">&quot;:&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>).<span class="ruby-identifier">downcase</span>)
                                <span class="ruby-identifier">privmsg</span>(<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-value str">&quot;:&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>),<span class="ruby-node">&quot;Hello #{s_spaces[2].sub(&quot;:&quot;,&quot;&quot;)} people!&quot;</span>)
                                <span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;NAMES #{s_spaces[2].sub(&quot;:&quot;,&quot;&quot;)}&quot;</span>)
                        <span class="ruby-keyword kw">else</span>
                                <span class="ruby-identifier">autoop</span>(<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-value str">&quot;:&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>),<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;!&quot;</span>)[<span class="ruby-value">0</span>]) <span class="ruby-comment cmt"># Auto-op nicks</span>
                        <span class="ruby-keyword kw">end</span>
                <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;QUIT&quot;</span> <span class="ruby-keyword kw">then</span>
                        <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">channel</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@channel</span>
                                <span class="ruby-identifier">log</span>(<span class="ruby-identifier">channel</span>,<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">2</span>],<span class="ruby-identifier">message</span>,<span class="ruby-value str">&quot;quit&quot;</span>)
                        <span class="ruby-keyword kw">end</span>
                <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;NICK&quot;</span> <span class="ruby-keyword kw">then</span>
                        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;!&quot;</span>)[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-ivar">@nick</span> <span class="ruby-keyword kw">then</span>
                                <span class="ruby-identifier">newnick</span> = <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-value str">&quot;:&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>).<span class="ruby-identifier">strip</span>
                                <span class="ruby-ivar">@nick</span> = <span class="ruby-identifier">newnick</span>
                        <span class="ruby-keyword kw">end</span>
                        <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">channel</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@channel</span>
                                <span class="ruby-identifier">log</span>(<span class="ruby-identifier">channel</span>,<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">0</span>],<span class="ruby-identifier">newnick</span>,<span class="ruby-value str">&quot;nick&quot;</span>)
                        <span class="ruby-keyword kw">end</span>
                        
                <span class="ruby-keyword kw">end</span>
                <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-node">&quot;:#{@server}&quot;</span>) <span class="ruby-keyword kw">then</span>
                        <span class="ruby-identifier">log</span>(<span class="ruby-value str">&quot;Network&quot;</span>,<span class="ruby-ivar">@server</span>,<span class="ruby-identifier">s</span>.<span class="ruby-identifier">strip</span>,<span class="ruby-value str">&quot;network&quot;</span>)
                        <span class="ruby-comment cmt"># Server message time! :naos.foonetic.net 353 NieXS @ #FaiD :</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Network message&quot;</span>
                        <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">1</span>]
                                <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;353&quot;</span> <span class="ruby-comment cmt"># NAMES list</span>
                                        <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;recieving NAMES list&quot;</span>
                                        <span class="ruby-identifier">userlist</span> = <span class="ruby-identifier">s_spaces</span>
                                        <span class="ruby-identifier">userlist</span> = <span class="ruby-identifier">userlist</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot; &quot;</span>)
                                        <span class="ruby-identifier">userlist</span> = <span class="ruby-identifier">userlist</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-node">&quot;#{s_spaces[0]} #{s_spaces[1]} #{s_spaces[2]} #{s_spaces[3]} #{s_spaces[4]} &quot;</span>,<span class="ruby-value str">&quot;&quot;</span>)
                                        <span class="ruby-identifier">userlist</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/(\+|%|@|&amp;|:)/</span>,<span class="ruby-value str">&quot;&quot;</span>)
                                        <span class="ruby-identifier">userlist</span> = <span class="ruby-identifier">userlist</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">split</span>
                                        <span class="ruby-ivar">@users</span>[<span class="ruby-identifier">s_spaces</span>[<span class="ruby-value">4</span>].<span class="ruby-identifier">downcase</span>] = <span class="ruby-identifier">userlist</span>
                                        <span class="ruby-identifier">puts</span> <span class="ruby-identifier">userlist</span>
                        <span class="ruby-keyword kw">end</span>
                <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span></pre>
</body>
</html>